<h2 mat-dialog-title align="center" #title bkDraggable dragTarget=".mat-dialog-container">
  @if (data.editMode) {
    <span>Редактировать запланированное</span>
  }
  @if (!data.editMode) {
    <span>Запланировать</span>
  }
</h2>
<mat-dialog-content id="budget-plan-dialog">
  <ul class="nav nav-tabs nav-justified">
    <li role="presentation" [ngClass]="{'active': data.type === 'goal', 'disabled': data.editMode}" (click)="onChangeSelectedType('goal')"><a>Цель</a></li>
    <li role="presentation" [ngClass]="{'active': data.type === 'category', 'disabled': data.editMode}" (click)="onChangeSelectedType('category')"><a>Категория</a></li>
    <li role="presentation" [ngClass]="{'active': data.type === 'limit', 'disabled': data.editMode}" (click)="onChangeSelectedType('limit')"><a>Лимит</a></li>
  </ul>

  @if (errors) {
    <div class="alert alert-dismissable fade in alert-danger error">
      <strong>{{errors}}</strong>
    </div>
  }

  <div class="table">
    <!--Goal month and year-->
    @if (data.type === 'goal') {
      <div class="row">
        <div class="col-sm-12">
          <bk-month-and-year class="right-button-group" [disabled]="!changeGoalMonthAvailable" [selectedYear]="selectedYear" [selectedMonth]="selectedMonth"
          (changeMonth)="changeMonth($event)" (changeYear)="changeYear($event)"></bk-month-and-year>
        </div>
      </div>
    }

    <!--All type-->
    <div class="row">
      <div class="col-sm-12">
        <div class="input-group">
          <span class="input-group-addon dropdown-addon">Тип:</span>
          <span type="button" class="btn btn-default dropdown-toggle dropdown-with-addon" [ngClass]="{'disabled': data.editMode, 'text-left': budgetType}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span [ngClass]="budgetType">{{getBudgetTypeName(budgetType)}}</span><span class="caret"></span>
          </span>
          <ul class="dropdown-menu full-width-dropdown">
            <li><a class="income" (click)="changeBudgetType('income')">{{getBudgetTypeName('income')}}</a></li>
            <li><a class="expense" (click)="changeBudgetType('expense')">{{getBudgetTypeName('expense')}}</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!--Category or goal category-->
    @if (data.type !== 'limit') {
      <div class="row">
        <div class="col-sm-12">
          <div class="input-group">
            <span class="input-group-addon dropdown-addon">Категория:</span>
            <span type="button" class="btn btn-default dropdown-toggle dropdown-with-addon" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
              [ngClass]="{'disabled': data.editMode || !budgetType || typeCategories.length === 0, 'text-left': categoryTitle, 'with-statistics': data.type === 'category'}">
              @if (categoryTitle) {
                <img class="icon" [src]="getCategoryIcon(categoryTitle) | assetImage:'category'">
              }
              <span [ngClass]="categoryTitle ? budgetType : ''">{{categoryTitle ? categoryTitle : (typeCategories.length === 0 ? 'Нет доступных категорий' : 'Категория')}}</span>
              <span class="caret"></span>
            </span>
            <ul class="dropdown-menu full-width-dropdown">
              @for (category of typeCategories; track category) {
                <li>
                  <a class="text-center" (click)="changeCategory(category)" [ngClass]="budgetType">
                    <img class="icon" [src]="getCategoryIcon(category.title) | assetImage:'category'">{{category.title}}
                  </a>
                </li>
              }
            </ul>
            @if (data.type === 'category') {
              <span [ngClass]="{'disabled': !categoryTitle}" class="btn btn-default glyphicon glyphicon-signal category-statistics" type="button" (click)="showStatistics()"></span>
            }
          </div>
        </div>
      </div>
    }

    <!--Goal title-->
    @if (data.type === 'goal') {
      <div class="row">
        <div class="col-sm-12">
          <div class="input-group full-width">
            <span class="input-group-addon dropdown-addon" id="basic-addon1">Название:</span>
            <input type="text" class="form-control" placeholder="Название цели" [disabled]="data.disableChangeGoalMonth" aria-describedby="basic-addon1" [(ngModel)]="goalTitle">
          </div>
        </div>
      </div>
    }

    <!--All balance-->
    @for (balance of currencyBalance; track balance) {
      <div class="row">
        <div  class="col-sm-12">
          <div class="input-group">
            <div class="input-group-btn">
              @if (data.type !== 'goal') {
                <span class="btn btn-default glyphicon glyphicon-plus" type="button" (click)="addCurrency()" ></span>
              }
              @if (data.type !== 'goal') {
                <span class="btn btn-default glyphicon glyphicon-minus" type="button" (click)="removeCurrency(balance)" ></span>
              }
              <span type="button" [ngClass]="{'single-currency': data.type === 'goal', 'multiple-currencies': data.type !== 'goal', 'disabled': !changeGoalMonthAvailable}" class="btn btn-default dropdown-toggle currency-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="float-left">
                  @if (balance.currency) {
                    <bk-currency-symbol [ngClass]="{'currency-selected-value': data.type !== 'goal'}" [currencyName]="balance.currency"></bk-currency-symbol>
                  }
                  @if (!balance.currency) {
                    <span>Валюта</span>
                  }
                </span>
                <span class="caret">
                </span>
              </span>
              <ul [ngClass]="{'single-currency': data.type === 'goal', 'multiple-currencies': data.type !== 'goal'}" class="dropdown-menu currency-dropdown-menu">
                @for (currency of currencies; track currency) {
                  <li (click)="balance.currency = currency.name"><a><bk-currency-symbol [currencyName]="currency.name"></bk-currency-symbol></a></li>
                }
              </ul>
            </div>
            <bk-input-calculator position="right" placeholder="Лимит" [value]="balance.completeValue" [showConfirm]="balance.showConfirm" [confirmValue]="balance.confirmValue"
            (changeInputValue)="balance.completeValue = $event" (changeConfirmValue)="balance.confirmValue = $event"></bk-input-calculator>
          </div>
        </div>
      </div>
    }

    @if (showDetails) {
      <div class="row">
        <div  class="col-sm-12 text-center"><span class="details">*</span> Игнорировать минимальное значение для валюты</div>
      </div>
    }
  </div>
</mat-dialog-content>
<mat-dialog-actions>
  <span class="full-width">
    <a class="btn btn-default footer-action-item" (click)="close(false)">Закрыть</a>
    <span class="footer-action-item">&nbsp;</span>
    <a class="btn btn-default footer-action-item" (click)="save()">Сохранить</a>
  </span>
</mat-dialog-actions>
